{% extends "admin_lte/elements/base.html" %}
{% load static %}

{% block title %}
    AdminLTE 3 | Starter
{% endblock %}

{% block head %}
{% endblock %}

{% block content %}
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">

        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-12">
                        <h1 class="m-0" style="text-align: center">Статистика</h1>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <div class="content">
            <div class="container-fluid">
                <div class="row">

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="m-0">Статистика пользователей</h5>
                            </div>
                            <div class="card-body">

                                <div class="card card-primary">
                                    <div class="card-header">
                                        <h3 class="card-title">Поисковые каналы</h3>

                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <button type="button" class="btn btn-tool" data-card-widget="remove">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chartjs-size-monitor">
                                            <div class="chartjs-size-monitor-expand">
                                                <div class=""></div>
                                            </div>
                                            <div class="chartjs-size-monitor-shrink">
                                                <div class=""></div>
                                            </div>
                                        </div>
                                        <canvas id="pieChartRequest"
                                                style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%; display: block; width: 730px;"
                                                width="730" height="250" class="chartjs-render-monitor"></canvas>
                                    </div>
                                    <!-- /.card-body -->
                                </div>

                            </div>
                        </div>

                    </div>

                    <div class="col-lg-4">

                        <div class="card">
                            <div class="card-header">
                                <h5 class="m-0">Сеансы</h5>
                            </div>
                            <div class="card-body">

                                <!-- LINE CHART -->
                                <div class="card card-info">
                                    <div class="card-header">
                                        <h3 class="card-title">Сеансы на неделю</h3>

                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <button type="button" class="btn btn-tool" data-card-widget="remove">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart">
                                            <canvas id="lineChart"
                                                    style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                                        </div>
                                    </div>
                                    <!-- /.card-body -->
                                </div>
                                <!-- /.card -->

                            </div>
                        </div>

                    </div>

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="m-0">Статистика пользователей</h5>
                            </div>
                            <div class="card-body">
                                <div class="small-box bg-warning">
                                    <div class="inner">
                                        <h3>{{ users_count }}</h3>
                                        <p>Активных пользователей</p>
                                    </div>
                                    <div class="icon">
                                        <i class="ion ion-android-person"></i>
                                    </div>
                                    <a href="{% url 'admin_lte:users_list' %}" class="small-box-footer">Список
                                        пользователей <i
                                                class="fas fa-arrow-circle-right"></i></a>
                                </div>

                                <div class="card card-warning">
                                    <div class="card-header">
                                        <h3 class="card-title">Пол пользователей</h3>

                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <button type="button" class="btn btn-tool" data-card-widget="remove">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chartjs-size-monitor">
                                            <div class="chartjs-size-monitor-expand">
                                                <div class=""></div>
                                            </div>
                                            <div class="chartjs-size-monitor-shrink">
                                                <div class=""></div>
                                            </div>
                                        </div>
                                        <canvas id="pieChart"
                                                style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%; display: block; width: 730px;"
                                                width="730" height="250" class="chartjs-render-monitor"></canvas>
                                    </div>
                                    <!-- /.card-body -->
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
                <!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content -->

    </div>
    <!-- /.content-wrapper -->
{% endblock %}

{% block scripts %}
    <!-- jQuery -->
    <script src="{% static 'admin_lte/plugins/jquery/jquery.min.js' %}"></script>
    <!-- Bootstrap 4 -->
    <script src="{% static 'admin_lte/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <!-- AdminLTE App -->
    <script src="{% static 'admin_lte/assets/js/adminlte.min.js' %}"></script>
    <!-- IONIC FRAMEWORK -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- CHART JS -->
    <script src="{% static 'admin_lte/plugins/chart.js/Chart.min.js' %}"></script>


    <script>
        $(function () {
            var men_count =
            {{ men_count }}
            var women_count =
            {{ women_count }}
            var donutData = {
                labels: [
                    'Мужчины',
                    'Женщины',
                ],
                datasets: [
                    {
                        data: [men_count, women_count],
                        backgroundColor: ['#0ec2ff', '#e4fa8e'],
                    }
                ]
            }


            //-------------
            //- PIE CHART -
            //-------------
            // Get context with jQuery - using jQuery's .get() method.
            var pieChartCanvas = $('#pieChart').get(0).getContext('2d')
            var pieData = donutData;
            var pieOptions = {
                maintainAspectRatio: false,
                responsive: true,
            }
            //Create pie or douhnut chart
            // You can switch between pie and douhnut using the method below.
            new Chart(pieChartCanvas, {
                type: 'pie',
                data: pieData,
                options: pieOptions
            })


        })

    </script>

    <script>
        $(function () {
            var labels = []
            var data = []
            var seance_data = JSON.parse('{{ logs_data_json|safe }}');

            for (let i = 0; i < seance_data.length; i++) {
                labels.push(seance_data[i].referer)
                data.push(seance_data[i].the_count)
            }

            var donutData = {
                labels: labels,
                datasets: [
                    {
                        data: data,
                        backgroundColor: ['#0ec2ff', '#e4fa8e', '#8e99fa', '#fa8ef8', '#f69642'],
                    }
                ]
            }


            //-------------
            //- PIE CHART -
            //-------------
            // Get context with jQuery - using jQuery's .get() method.
            var pieChartCanvas = $('#pieChartRequest').get(0).getContext('2d')
            var pieData = donutData;
            var pieOptions = {
                maintainAspectRatio: false,
                responsive: true,
            }
            //Create pie or douhnut chart
            // You can switch between pie and douhnut using the method below.
            new Chart(pieChartCanvas, {
                type: 'pie',
                data: pieData,
                options: pieOptions
            })


        })

    </script>

    <script>
        window.onload = function () {
            //-------------
            //- Data handling
            //--------------
            {#sasaf = {{ seance_data.time }}#}
            var labels = []
            var data = []
            var seance_data = JSON.parse('{{ seance_data|safe }}');

            for (let i = 0; i < seance_data.length; i++) {
                labels.push(seance_data[i].date)
                data.push(seance_data[i].seance_count)
            }
            {#alert(JSON.parse(seance_data)[0])#}

            const areaChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                showTooltips: true,

                legend: {
                    display: false
                },
            };

            const areaChartData = {
                labels: labels,
                datasets: [
                    {
                        label: 'Количество сеансов',
                        backgroundColor: 'rgba(60,141,188,0.9)',
                        borderColor: 'rgba(60,141,188,0.8)',
                        {#pointRadius: false,#}
                        pointColor: '#3b8bba',
                        pointStrokeColor: 'rgba(60,141,188,1)',
                        pointHighlightFill: '#fff',
                        pointHighlightStroke: 'rgba(60,141,188,1)',
                        data: data
                    }
                ]
            };

            //-------------
            //- LINE CHART -
            //--------------
            var lineChartCanvas = $('#lineChart').get(0).getContext('2d')
            var lineChartOptions = $.extend(true, {}, areaChartOptions)
            var lineChartData = $.extend(true, {}, areaChartData)
            lineChartData.datasets[0].fill = false;
            lineChartOptions.datasetFill = false

            var lineChart = new Chart(lineChartCanvas, {
                type: 'line',
                data: lineChartData,
                options: lineChartOptions
            })
        };


    </script>

{% endblock %}
